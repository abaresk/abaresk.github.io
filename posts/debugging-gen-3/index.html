<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Debugging Gen III Pokémon Games - Abaresk's Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="Abaresk"><meta name=description content="I&amp;rsquo;d like to quickly share my setup for debugging Gen III Pokémon games. This setup has helped me both understand how undocumented parts of the games work and also create the mods on this site. Hopefully sharing this helps others looking to do the same.
This setup is compatible with the pokeruby, pokefirered, and pokeemerald projects on Linux, MacOS, or WSL.
VSCode VSCode offers a great interface for debugging code. The experience is streamlined into the code editor and uses the source code to provide useful context while debugging."><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.84.2 with theme even"><link rel=canonical href=http://localhost:1313/posts/debugging-gen-3/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.601bda035c09592ab15090613fd4e92f33dd4c653087becd8f319815b11e7bbf.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=/css/custom.css><meta property="og:title" content="Debugging Gen III Pokémon Games"><meta property="og:description" content="I&rsquo;d like to quickly share my setup for debugging Gen III Pokémon games. This setup has helped me both understand how undocumented parts of the games work and also create the mods on this site. Hopefully sharing this helps others looking to do the same.
This setup is compatible with the pokeruby, pokefirered, and pokeemerald projects on Linux, MacOS, or WSL.
VSCode VSCode offers a great interface for debugging code. The experience is streamlined into the code editor and uses the source code to provide useful context while debugging."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/debugging-gen-3/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-06-17T08:08:57-04:00"><meta property="article:modified_time" content="2021-06-17T08:08:57-04:00"><meta itemprop=name content="Debugging Gen III Pokémon Games"><meta itemprop=description content="I&rsquo;d like to quickly share my setup for debugging Gen III Pokémon games. This setup has helped me both understand how undocumented parts of the games work and also create the mods on this site. Hopefully sharing this helps others looking to do the same.
This setup is compatible with the pokeruby, pokefirered, and pokeemerald projects on Linux, MacOS, or WSL.
VSCode VSCode offers a great interface for debugging code. The experience is streamlined into the code editor and uses the source code to provide useful context while debugging."><meta itemprop=datePublished content="2021-06-17T08:08:57-04:00"><meta itemprop=dateModified content="2021-06-17T08:08:57-04:00"><meta itemprop=wordCount content="493"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Debugging Gen III Pokémon Games"><meta name=twitter:description content="I&rsquo;d like to quickly share my setup for debugging Gen III Pokémon games. This setup has helped me both understand how undocumented parts of the games work and also create the mods on this site. Hopefully sharing this helps others looking to do the same.
This setup is compatible with the pokeruby, pokefirered, and pokeemerald projects on Linux, MacOS, or WSL.
VSCode VSCode offers a great interface for debugging code. The experience is streamlined into the code editor and uses the source code to provide useful context while debugging."><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Abaresk</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/posts/><li class=mobile-menu-item>Posts</li></a><a href=/mods/><li class=mobile-menu-item>Mods</li></a><a href=/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>Abaresk</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/posts/>Posts</a></li><li class=menu-item><a class=menu-item-link href=/mods/>Mods</a></li><li class=menu-item><a class=menu-item-link href=/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Debugging Gen III Pokémon Games</h1><div class=post-meta><span class=post-time>June 17, 2021</span>
<span class=more-meta>3 mins read</span></div></header><div class=post-content><p>I&rsquo;d like to quickly share my setup for debugging Gen III Pokémon games. This setup has helped me both understand how undocumented parts of the games work and also create the mods on this site. Hopefully sharing this helps others looking to do the same.</p><p>This setup is compatible with the <a href=www.github.com/pret/pokeruby>pokeruby</a>, <a href=www.github.com/pret/pokefirered>pokefirered</a>, and <a href=www.github.com/pret/pokeemerald>pokeemerald</a> projects on Linux, MacOS, or WSL.</p><h1 id=vscode>VSCode</h1><p><a href=https://code.visualstudio.com/>VSCode</a> offers a great interface for <a href=https://code.visualstudio.com/docs/editor/debugging>debugging</a> code. The experience is streamlined into the code editor and uses the source code to provide useful context while debugging. Let me explain with a few examples.</p><h2 id=setting-breakpoints>Setting breakpoints</h2><p>You can set a breakpoint at a particular line of code. When that line is executed, the progam pauses, allowing you to inspect program state (such as RAM variables and the call stack). You can then follow the program as it executes line-by-line.</p><p>This action is highly streamlined in VSCode &ndash; you simply click next to a line of code to add a breakpoint:</p><br><figure><img src=/posts/debugging-gen-3/breakpoint.png></figure><br><h2 id=watching-global-variables>Watching global variables</h2><p>The Gen III Pokémon games use many global variables. VSCode allows you to watch these variables &ndash; when the program is paused, you can see their current values. The interface can interprets and displays C data types, allowing you to easily explore how structs and arrays defined in the source code are used.</p><p>For example, we can watch the internal representation of a trainer card <code>sTrainerCard->trainerCard</code>. When the game is paused, we see its value which includes the trainer ID, money, and play time:</p><br><figure><img src=/posts/debugging-gen-3/watching.png></figure><br><h2 id=setting-watchpoints>Setting watchpoints</h2><p>Sometimes a global variable will change, and you&rsquo;d like to figure out exactly when it happened. In VSCode, you can set a watchpoint on a global variable. When the value of the variable changes, VSCode pauses the program and shows you the line of code that made the change.</p><p>For example, the colon in the trainer card&rsquo;s play time ticks every second. To find out which line causes this, we set a watchpoint in VSCode&rsquo;s debug console:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>-exec watch sTrainerCard-&gt;timeColonInvisible
</code></pre></td></tr></table></div></div><p>Then the game will pause whenver the value of <code>sTrainerCard->timeColonInvisible</code> changes:</p><br><figure><img src=/posts/debugging-gen-3/watchpoint.png></figure><br><h1 id=setup>Setup</h1><p>In addition to VSCode, this setup requires the <a href=https://mgba.io>mGBA</a> emulator, and <a href=https://devkitpro.org/wiki/Getting_Started>devkitPro</a>. mGBA comes with a gdb server, which VSCode can hook into to issue debugging commands.</p><p>In VSCode, you can configure your debugging setup in the <code>.vscode/launch.json</code> file of your project. We specify a launch configuration which boots up mGBA and the debugging server. The configuration contains a <code>preLaunchTask</code> defined in <code>.vscode/tasks.json</code>, which builds the game with debug symbols, loads it into mGBA, and starts the server.</p><h1 id=notes>Notes</h1><p>In order to use this setup on WSL, the project folder must be located in the WSL file system.</p><p>It is worth noting that because these games are compiled at the -O2 <a href=https://gcc.gnu.org/onlinedocs/gnat_ugn/Optimization-Levels.html>optimization level</a>, some variables and lines of code are optimized out of the game. If needed, you can recover these by inserting calls to dummy functions.</p><p>Special thanks to <a href=https://github.com/Sierraffinity>Sierraffinity</a> for first documenting this workflow.</p><h1 id=links>Links</h1><p><a href=https://gist.github.com/abaresk/436a42d01534f169d3d3a763fde24fcf>VSCode workflow</a></p></div></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=http://github.com/abaresk class="iconfont icon-github" title=github target=_blank></a><a href=https://www.youtube.com/channel/UCBnmj3mxWjo_iMMnUu5qUeA class="iconfont icon-youtube" title=youtube target=_blank></a></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=/js/main.min.c99b103c33d1539acf3025e1913697534542c4a5aa5af0ccc20475ed2863603b.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-661Q4DJ55Q"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-661Q4DJ55Q',{anonymize_ip:!0})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-661Q4DJ55Q','auto'),ga('set','anonymizeIp',!0),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>